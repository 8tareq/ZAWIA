<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALANHAR SILVER - نظام إدارة الفضة</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Tahoma', 'Geneva', 'Verdana', sans-serif;
        }
        
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e67e22;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --border-radius: 12px;
            --box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            --gradient-primary: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            --gradient-success: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            --gradient-warning: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ed 100%);
            color: #333;
            line-height: 1.7;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header Styles */
        header {
            background: var(--gradient-primary);
            color: white;
            padding: 25px 0;
            margin-bottom: 35px;
            box-shadow: var(--box-shadow);
            border-radius: 0 0 var(--border-radius) var(--border-radius);
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            gap: 15px;
        }
        
        .logo i {
            font-size: 3rem;
            color: #f1c40f;
            filter: drop-shadow(0 0 5px rgba(241, 196, 15, 0.5));
        }
        
        .logo h1 {
            font-size: 2.8rem;
            font-weight: 800;
            letter-spacing: 1.5px;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .logo span {
            color: #f1c40f;
            text-shadow: 0 0 10px rgba(241, 196, 15, 0.3);
        }
        
        .dollar {
            color: #f1c40f !important;
            font-weight: bold;
            margin: 0 3px;
        }
        
        .subtitle {
            text-align: center;
            font-size: 1.3rem;
            opacity: 0.95;
            font-weight: 300;
        }
        
        /* Dashboard Stats */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
        }
        
        .stat-card.purchase::before { background: var(--secondary-color); }
        .stat-card.sales::before { background: var(--success-color); }
        .stat-card.inventory::before { background: var(--accent-color); }
        .stat-card.profit::before { background: var(--warning-color); }
        
        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
        }
        
        .stat-card i {
            font-size: 3rem;
            margin-bottom: 20px;
            display: block;
        }
        
        .stat-card.purchase i { color: var(--secondary-color); }
        .stat-card.sales i { color: var(--success-color); }
        .stat-card.inventory i { color: var(--accent-color); }
        .stat-card.profit i { color: var(--warning-color); }
        
        .stat-card h3 {
            font-size: 2rem;
            margin-bottom: 12px;
            color: var(--primary-color);
        }
        
        .stat-card p {
            color: #666;
            font-size: 1.1rem;
            font-weight: 500;
        }
        
        /* Main Content */
        .content-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 35px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 1100px) {
            .content-wrapper {
                grid-template-columns: 1fr;
            }
        }
        
        .section {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
            transition: all 0.3s ease;
        }
        
        .section:hover {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
        }
        
        .section-title {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--light-color);
        }
        
        .section-title i {
            font-size: 2rem;
            margin-left: 15px;
            color: var(--secondary-color);
        }
        
        .section-title h2 {
            font-size: 1.9rem;
            color: var(--primary-color);
            font-weight: 700;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--primary-color);
            font-size: 1.05rem;
        }
        
        .form-control {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: all 0.3s;
            background-color: #fafafa;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--secondary-color);
            background-color: white;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        /* Quantity Distribution */
        .quantity-distribution {
            background: #f8f9fa;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-top: 15px;
            border: 2px dashed #dee2e6;
        }
        
        .distribution-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #e9ecef;
        }
        
        .distribution-item:last-child {
            margin-bottom: 0;
        }
        
        .distribution-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .distribution-quantity {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .distribution-quantity input {
            width: 100px;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            text-align: center;
        }
        
        .remove-source {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .remove-source:hover {
            background: #c0392b;
        }
        
        .selected-sources {
            background: #e8f5e9;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 15px;
            border: 1px solid #c8e6c9;
        }
        
        .selected-sources h4 {
            color: #27ae60;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .selected-sources-list {
            max-height: 150px;
            overflow-y: auto;
        }
        
        .selected-source-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 12px;
            background: white;
            border-radius: 5px;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .selected-source-item:last-child {
            margin-bottom: 0;
        }
        
        /* Radio Buttons */
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 10px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .radio-option:hover {
            border-color: var(--secondary-color);
            background-color: #edf7ff;
        }
        
        .radio-option input[type="checkbox"] {
            margin-left: 10px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .radio-option label {
            margin-bottom: 0;
            cursor: pointer;
            flex: 1;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 14px 30px;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1.05rem;
            font-weight: 600;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 15px rgba(52, 152, 219, 0.3);
        }
        
        .btn-success {
            background: var(--gradient-success);
        }
        
        .btn-success:hover {
            box-shadow: 0 7px 15px rgba(39, 174, 96, 0.3);
        }
        
        .btn-warning {
            background: var(--gradient-warning);
        }
        
        .btn-warning:hover {
            box-shadow: 0 7px 15px rgba(243, 156, 18, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }
        
        .btn-danger:hover {
            box-shadow: 0 7px 15px rgba(231, 76, 60, 0.3);
        }
        
        .btn-sm {
            padding: 8px 15px;
            font-size: 0.9rem;
        }
        
        /* Table Styles */
        .table-container {
            overflow-x: auto;
            margin-top: 25px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 700px;
        }
        
        table thead {
            background: var(--gradient-primary);
            color: white;
        }
        
        table th {
            padding: 18px 15px;
            text-align: center;
            font-weight: 600;
            font-size: 1.05rem;
        }
        
        table td {
            padding: 16px 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        
        table tbody tr {
            transition: all 0.2s;
        }
        
        table tbody tr:hover {
            background-color: #f8fafc;
            transform: scale(1.005);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
        }
        
        .badge {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            display: inline-block;
        }
        
        .badge-purchase {
            background-color: #e3f2fd;
            color: #1565c0;
        }
        
        .badge-sale {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        /* Date Selection */
        .date-selection {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            text-align: center;
            border: 2px dashed #dee2e6;
        }
        
        .date-selection label {
            font-weight: 600;
            margin-left: 15px;
            font-size: 1.1rem;
            color: var(--primary-color);
        }
        
        .date-selection input {
            margin-left: 15px;
            padding: 10px 15px;
            border-radius: 8px;
            border: 2px solid #ced4da;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .date-selection input:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        /* Report Content */
        #reportContent {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        /* Print Styles - ملونة وجميلة */
        @media print {
            @page {
                size: A4;
                margin: 15mm;
            }
            
            body {
                background: white !important;
                color: black !important;
                font-size: 12pt !important;
                visibility: hidden;
            }
            
            #printable-report {
                visibility: visible;
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background: white !important;
                padding: 0 !important;
                margin: 0 !important;
                font-size: 12pt !important;
                color: black !important;
            }
            
            .print-header {
                text-align: center;
                margin-bottom: 25px;
                padding-bottom: 20px;
                border-bottom: 3px solid #2c3e50;
                background: linear-gradient(to right, #2c3e50, #3498db) !important;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                color: white !important;
                padding: 20px !important;
                border-radius: 10px !important;
            }
            
            .print-header h1 {
                color: white !important;
                font-size: 24pt !important;
                margin-bottom: 10px !important;
            }
            
            .print-header h2 {
                color: #f1c40f !important;
                font-size: 18pt !important;
                margin-bottom: 15px !important;
            }
            
            .print-summary {
                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                padding: 20px !important;
                border-radius: 10px !important;
                margin-bottom: 25px !important;
                border: 1px solid #ddd !important;
            }
            
            .print-table {
                width: 100% !important;
                border-collapse: collapse !important;
                margin: 20px 0 !important;
                font-size: 11pt !important;
                page-break-inside: avoid !important;
            }
            
            .print-table th {
                background: linear-gradient(to right, #2c3e50, #3498db) !important;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                color: white !important;
                padding: 12px 8px !important;
                text-align: center !important;
                border: 1px solid #1a2530 !important;
                font-weight: bold !important;
            }
            
            .print-table td {
                padding: 10px 8px !important;
                text-align: center !important;
                border: 1px solid #ddd !important;
                page-break-inside: avoid !important;
                page-break-before: auto !important;
            }
            
            .print-table tr:nth-child(even) {
                background-color: #f9f9f9 !important;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            .print-totals {
                background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%) !important;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                padding: 20px !important;
                border-radius: 10px !important;
                margin: 25px 0 !important;
                border: 1px solid #c8e6c9 !important;
            }
            
            .print-signature {
                margin-top: 40px !important;
                padding-top: 20px !important;
                border-top: 2px dashed #2c3e50 !important;
                page-break-inside: avoid !important;
            }
            
            .profit-positive {
                color: #27ae60 !important;
                font-weight: bold !important;
            }
            
            .profit-negative {
                color: #e74c3c !important;
                font-weight: bold !important;
            }
            
            .dollar-print {
                color: #f39c12 !important;
                font-weight: bold !important;
            }
            
            /* إخفاء جميع العناصر الأخرى */
            body > *:not(#printable-report) {
                display: none !important;
            }
            
            #printable-report > * {
                display: block !important;
            }
        }
        
        /* Footer */
        footer {
            text-align: center;
            margin-top: 50px;
            padding: 25px 0;
            border-top: 1px solid #dee2e6;
            color: #666;
            background-color: white;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            box-shadow: 0 -3px 10px rgba(0, 0, 0, 0.05);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .logo h1 {
                font-size: 2.2rem;
            }
            
            .logo i {
                font-size: 2.5rem;
            }
            
            .section {
                padding: 20px;
            }
            
            .section-title h2 {
                font-size: 1.6rem;
            }
            
            .stat-card {
                padding: 20px;
            }
            
            .stat-card h3 {
                font-size: 1.7rem;
            }
            
            .btn {
                padding: 12px 20px;
                width: 100%;
            }
            
            .date-selection {
                padding: 15px;
            }
            
            .date-selection button {
                margin-top: 10px;
                width: 100%;
            }
            
            .distribution-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .distribution-quantity {
                width: 100%;
            }
            
            .distribution-quantity input {
                width: 100%;
            }
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--secondary-color);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #2980b9;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <i class="fas fa-gem"></i>
                <h1>ALANHAR <span>SILVER</span></h1>
            </div>
            <p class="subtitle">نظام إدارة مخزون وتجارة الفضة | Gümüş Stok ve Ticaret Yönetim Sistemi</p>
        </div>
    </header>
    
    <div class="container">
        <!-- Dashboard Stats -->
        <div class="stats-container">
            <div class="stat-card purchase">
                <i class="fas fa-shopping-cart"></i>
                <h3 id="total-purchases">0 كغ</h3>
                <p>إجمالي المشتريات | Toplam Alımlar</p>
            </div>
            <div class="stat-card sales">
                <i class="fas fa-chart-line"></i>
                <h3 id="total-sales">0 كغ</h3>
                <p>إجمالي المبيعات | Toplam Satışlar</p>
            </div>
            <div class="stat-card inventory">
                <i class="fas fa-boxes"></i>
                <h3 id="current-inventory">0 كغ</h3>
                <p>المخزون الحالي | Mevcut Stok</p>
            </div>
            <div class="stat-card profit">
                <i class="fas fa-money-bill-wave"></i>
                <h3 id="total-profit">0 <span class="dollar">$</span></h3>
                <p>إجمالي الربح | Toplam Kâr</p>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="content-wrapper">
            <!-- Purchase Section -->
            <div class="section">
                <div class="section-title">
                    <i class="fas fa-cart-plus"></i>
                    <h2>إضافة شراء جديد | Yeni Alım Ekle</h2>
                </div>
                <form id="purchaseForm">
                    <div class="form-group">
                        <label for="purchaseQuantity">الكمية (كيلوغرام) | Miktar (kg)</label>
                        <input type="number" id="purchaseQuantity" class="form-control" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="purchasePrice">سعر الشراء (لكل كيلو) | Alış Fiyatı (kg başına) <span class="dollar">$</span></label>
                        <input type="number" id="purchasePrice" class="form-control" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="purchaseDate">تاريخ الشراء | Alış Tarihi</label>
                        <input type="date" id="purchaseDate" class="form-control" required>
                    </div>
                    <button type="submit" class="btn">
                        <i class="fas fa-save"></i> تسجيل عملية الشراء | Alımı Kaydet
                    </button>
                </form>
                
                <!-- Purchases List -->
                <div class="section-title" style="margin-top: 35px;">
                    <i class="fas fa-list"></i>
                    <h2>سجل المشتريات | Alım Kayıtları</h2>
                </div>
                <div class="table-container">
                    <table id="purchasesTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>الكمية | Miktar</th>
                                <th>سعر الشراء | Alış Fiyatı</th>
                                <th>الإجمالي | Toplam</th>
                                <th>التاريخ | Tarih</th>
                                <th>المتبقي | Kalan</th>
                            </tr>
                        </thead>
                        <tbody id="purchasesTableBody">
                            <!-- سيتم ملؤها بواسطة JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Sales Section -->
            <div class="section">
                <div class="section-title">
                    <i class="fas fa-cash-register"></i>
                    <h2>إضافة بيع جديد | Yeni Satış Ekle</h2>
                </div>
                <form id="saleForm">
                    <div class="form-group">
                        <label for="customerName">اسم العميل | Müşteri Adı</label>
                        <input type="text" id="customerName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="saleQuantity">كمية البيع (كغ) | Satış Miktarı (kg)</label>
                        <input type="number" id="saleQuantity" class="form-control" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="salePrice">سعر البيع (لكل كغ) | Satış Fiyatı (kg başına) <span class="dollar">$</span></label>
                        <input type="number" id="salePrice" class="form-control" step="0.01" min="0" required>
                    </div>
                    
                    <!-- Purchase Selection - Multiple Sources -->
                    <div class="form-group">
                        <label>اختر مصادر الكمية المباعة | Satılacak Miktarın Kaynaklarını Seçin:</label>
                        <div id="purchaseOptions" class="radio-group">
                            <!-- سيتم ملؤها بواسطة JavaScript -->
                        </div>
                        
                        <!-- Selected Sources Distribution -->
                        <div id="quantityDistribution" class="quantity-distribution" style="display: none;">
                            <h4 style="margin-bottom: 15px; color: var(--primary-color);">توزيع الكمية على المصادر المختارة | Seçilen Kaynaklara Miktar Dağıtımı</h4>
                            <div id="distributionList">
                                <!-- سيتم ملؤها بواسطة JavaScript -->
                            </div>
                            <div style="margin-top: 15px; padding: 10px; background: #e8f4ff; border-radius: 5px;">
                                <p>المجموع الموزع | Dağıtılan Toplam: <span id="distributedTotal">0</span> كغ / الكمية المطلوبة | Gerekli Miktar: <span id="requiredQuantity">0</span> كغ</p>
                                <p id="distributionMessage" style="margin-top: 5px; font-size: 0.9rem;"></p>
                            </div>
                        </div>
                        
                        <!-- Selected Sources Summary -->
                        <div id="selectedSourcesSummary" class="selected-sources" style="display: none;">
                            <h4>المصادر المختارة | Seçilen Kaynaklar</h4>
                            <div id="selectedSourcesList" class="selected-sources-list">
                                <!-- سيتم ملؤها بواسطة JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-success" id="submitSaleBtn">
                        <i class="fas fa-check-circle"></i> تسجيل عملية البيع | Satışı Kaydet
                    </button>
                </form>
                
                <!-- Sales List -->
                <div class="section-title" style="margin-top: 35px;">
                    <i class="fas fa-receipt"></i>
                    <h2>سجل المبيعات | Satış Kayıtları</h2>
                </div>
                <div class="table-container">
                    <table id="salesTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>العميل | Müşteri</th>
                                <th>الكمية | Miktar</th>
                                <th>سعر البيع | Satış Fiyatı</th>
                                <th>الإجمالي | Toplam</th>
                                <th>الربح | Kâr</th>
                                <th>التاريخ | Tarih</th>
                                <th>المصادر | Kaynaklar</th>
                            </tr>
                        </thead>
                        <tbody id="salesTableBody">
                            <!-- سيتم ملؤها بواسطة JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Report Section -->
        <div class="section no-print" style="margin-bottom: 40px;">
            <div class="section-title">
                <i class="fas fa-file-invoice-dollar"></i>
                <h2>تقرير مفصل للمبيعات | Detaylı Satış Raporu</h2>
            </div>
            
            <div class="date-selection">
                <label for="reportDate">اختر تاريخ التقرير | Rapor Tarihini Seçin:</label>
                <input type="date" id="reportDate" value="">
                <button class="btn btn-warning" onclick="generateTodayReport()">
                    <i class="fas fa-calendar-day"></i> تقرير اليوم | Bugünün Raporu
                </button>
                <button class="btn" onclick="generateDetailedReport()">
                    <i class="fas fa-search"></i> عرض التقرير | Raporu Görüntüle
                </button>
                <button class="btn btn-success" onclick="printReportDirectly()">
                    <i class="fas fa-print"></i> طباعة التقرير | Raporu Yazdır
                </button>
            </div>
            
            <div id="reportContent">
                <!-- سيتم ملؤها بواسطة JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- Printable Report (Hidden by default) -->
    <div id="printable-report" style="display: none;"></div>
    
    <footer class="container no-print">
        <p>ALANHAR SILVER - نظام إدارة مخزون الفضة | Gümüş Stok Yönetim Sistemi © 2023</p>
        <p style="margin-top: 10px; font-size: 0.9rem;">جميع الحقوق محفوظة | Tüm hakları saklıdır</p>
    </footer>

    <script>
        // البيانات الأساسية
        let purchases = [];
        let sales = [];
        let selectedPurchaseSources = [];
        let quantityDistribution = {};
        
        // تحميل البيانات من localStorage إذا كانت موجودة
        document.addEventListener('DOMContentLoaded', function() {
            // تعيين تاريخ اليوم كتاريخ افتراضي
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('purchaseDate').value = today;
            document.getElementById('reportDate').value = today;
            
            // تحميل البيانات المخزنة
            if (localStorage.getItem('alanharPurchases')) {
                purchases = JSON.parse(localStorage.getItem('alanharPurchases'));
            }
            
            if (localStorage.getItem('alanharSales')) {
                sales = JSON.parse(localStorage.getItem('alanharSales'));
            }
            
            // تحديث الواجهة
            updatePurchasesTable();
            updateSalesTable();
            updateDashboardStats();
            updatePurchaseOptions();
            
            // إنشاء تقرير اليوم عند التحميل
            generateTodayReport();
        });
        
        // إضافة عملية شراء جديدة
        document.getElementById('purchaseForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const quantity = parseFloat(document.getElementById('purchaseQuantity').value);
            const price = parseFloat(document.getElementById('purchasePrice').value);
            const date = document.getElementById('purchaseDate').value;
            
            if (quantity <= 0 || price <= 0) {
                alert('الرجاء إدخال قيم صحيحة أكبر من الصفر | Lütfen sıfırdan büyük geçerli değerler girin');
                return;
            }
            
            const purchase = {
                id: Date.now(),
                quantity: quantity,
                price: price,
                total: quantity * price,
                date: date,
                remaining: quantity
            };
            
            purchases.push(purchase);
            saveData();
            updatePurchasesTable();
            updateDashboardStats();
            updatePurchaseOptions();
            
            // إعادة تعيين النموذج
            document.getElementById('purchaseForm').reset();
            document.getElementById('purchaseDate').value = new Date().toISOString().split('T')[0];
            
            alert('تم تسجيل عملية الشراء بنجاح! | Alım başarıyla kaydedildi!');
        });
        
        // تحديث خيارات الشراء للبيع (متعددة المصادر)
        function updatePurchaseOptions() {
            const purchaseOptions = document.getElementById('purchaseOptions');
            purchaseOptions.innerHTML = '';
            
            purchases.forEach(purchase => {
                if (purchase.remaining > 0) {
                    const optionId = `purchase-${purchase.id}`;
                    const isSelected = selectedPurchaseSources.includes(purchase.id);
                    
                    const optionHTML = `
                        <div class="radio-option">
                            <input type="checkbox" id="${optionId}" name="purchaseSource" value="${purchase.id}" ${isSelected ? 'checked' : ''} onchange="togglePurchaseSource(${purchase.id})">
                            <label for="${optionId}">
                                <strong>${purchase.quantity.toFixed(2)} كغ (${purchase.remaining.toFixed(2)} متبقي) | kg (${purchase.remaining.toFixed(2)} kalan)</strong><br>
                                <small>سعر الشراء: <span class="dollar">$</span> ${purchase.price.toFixed(2)} للكغ | Alış fiyatı: <span class="dollar">$</span> ${purchase.price.toFixed(2)}/kg</small>
                            </label>
                        </div>
                    `;
                    purchaseOptions.innerHTML += optionHTML;
                }
            });
            
            // إذا لم توجد مشتريات متاحة
            if (purchaseOptions.innerHTML === '') {
                purchaseOptions.innerHTML = '<p style="color: #e74c3c; text-align: center; padding: 20px;">لا توجد مشتريات متاحة للبيع | Satış için mevcut alım yok</p>';
            }
            
            // تحديث توزيع الكمية إذا كانت هناك مصادر مختارة
            if (selectedPurchaseSources.length > 0) {
                updateQuantityDistribution();
            }
        }
        
        // تبديل اختيار مصدر الشراء
        function togglePurchaseSource(purchaseId) {
            const index = selectedPurchaseSources.indexOf(purchaseId);
            const saleQuantity = parseFloat(document.getElementById('saleQuantity').value) || 0;
            
            if (index === -1) {
                // إضافة المصدر
                selectedPurchaseSources.push(purchaseId);
                quantityDistribution[purchaseId] = 0;
            } else {
                // إزالة المصدر
                selectedPurchaseSources.splice(index, 1);
                delete quantityDistribution[purchaseId];
            }
            
            // عرض أو إخفاء توزيع الكمية
            if (selectedPurchaseSources.length > 0) {
                document.getElementById('quantityDistribution').style.display = 'block';
                document.getElementById('selectedSourcesSummary').style.display = 'block';
                updateQuantityDistribution();
            } else {
                document.getElementById('quantityDistribution').style.display = 'none';
                document.getElementById('selectedSourcesSummary').style.display = 'none';
            }
            
            // تحديث الملخص
            updateSelectedSourcesSummary();
        }
        
        // تحديث توزيع الكمية
        function updateQuantityDistribution() {
            const saleQuantity = parseFloat(document.getElementById('saleQuantity').value) || 0;
            const distributionList = document.getElementById('distributionList');
            distributionList.innerHTML = '';
            
            let totalDistributed = 0;
            
            selectedPurchaseSources.forEach(purchaseId => {
                const purchase = purchases.find(p => p.id === purchaseId);
                if (!purchase) return;
                
                // تخصيص كمية افتراضية بناءً على الكمية المتبقية
                let defaultQuantity = 0;
                if (saleQuantity > 0) {
                    // توزيع متناسب مع الكمية المتبقية
                    const remainingTotal = selectedPurchaseSources.reduce((sum, id) => {
                        const p = purchases.find(p => p.id === id);
                        return sum + (p ? p.remaining : 0);
                    }, 0);
                    
                    if (remainingTotal > 0) {
                        defaultQuantity = Math.min(purchase.remaining, (purchase.remaining / remainingTotal) * saleQuantity);
                    }
                }
                
                // استخدام القيمة السابقة أو الافتراضية
                const currentQuantity = quantityDistribution[purchaseId] || defaultQuantity;
                totalDistributed += currentQuantity;
                
                const distributionItem = document.createElement('div');
                distributionItem.className = 'distribution-item';
                distributionItem.innerHTML = `
                    <div class="distribution-info">
                        <div>
                            <strong>مصدر #${purchase.id}</strong>
                            <div style="font-size: 0.9rem; color: #666;">
                                ${purchase.quantity.toFixed(2)} كغ (${purchase.remaining.toFixed(2)} متبقي)<br>
                                سعر: <span class="dollar">$</span> ${purchase.price.toFixed(2)}
                            </div>
                        </div>
                    </div>
                    <div class="distribution-quantity">
                        <input type="number" 
                               id="dist-${purchase.id}" 
                               value="${currentQuantity.toFixed(2)}" 
                               step="0.01" 
                               min="0" 
                               max="${purchase.remaining}"
                               onchange="updateDistributionQuantity(${purchase.id}, this.value)"
                               oninput="updateDistributionQuantity(${purchase.id}, this.value)">
                        <span>كغ</span>
                        <button type="button" class="remove-source" onclick="removeSource(${purchase.id})">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                
                distributionList.appendChild(distributionItem);
                quantityDistribution[purchaseId] = currentQuantity;
            });
            
            // تحديث الإجمالي والرسالة
            document.getElementById('distributedTotal').textContent = totalDistributed.toFixed(2);
            document.getElementById('requiredQuantity').textContent = saleQuantity.toFixed(2);
            
            const distributionMessage = document.getElementById('distributionMessage');
            if (Math.abs(totalDistributed - saleQuantity) < 0.01) {
                distributionMessage.innerHTML = '<span style="color: #27ae60;"><i class="fas fa-check-circle"></i> الكمية موزعة بشكل صحيح</span>';
            } else if (totalDistributed < saleQuantity) {
                const remaining = saleQuantity - totalDistributed;
                distributionMessage.innerHTML = `<span style="color: #e67e22;"><i class="fas fa-exclamation-triangle"></i> تحتاج إلى توزيع ${remaining.toFixed(2)} كغ إضافية</span>`;
            } else {
                const extra = totalDistributed - saleQuantity;
                distributionMessage.innerHTML = `<span style="color: #e74c3c;"><i class="fas fa-exclamation-circle"></i> هناك زيادة ${extra.toFixed(2)} كغ عن المطلوب</span>`;
            }
        }
        
        // تحديث كمية التوزيع لمصدر معين
        function updateDistributionQuantity(purchaseId, value) {
            const quantity = parseFloat(value) || 0;
            const purchase = purchases.find(p => p.id === purchaseId);
            
            if (purchase && quantity <= purchase.remaining) {
                quantityDistribution[purchaseId] = quantity;
                updateQuantityDistribution();
            } else if (purchase) {
                // إذا تجاوزت الكمية المتبقية
                document.getElementById(`dist-${purchaseId}`).value = purchase.remaining.toFixed(2);
                quantityDistribution[purchaseId] = purchase.remaining;
                updateQuantityDistribution();
                alert(`الحد الأقصى للمصدر #${purchaseId} هو ${purchase.remaining.toFixed(2)} كغ`);
            }
        }
        
        // إزالة مصدر من القائمة
        function removeSource(purchaseId) {
            const index = selectedPurchaseSources.indexOf(purchaseId);
            if (index !== -1) {
                selectedPurchaseSources.splice(index, 1);
                delete quantityDistribution[purchaseId];
                
                // تحديث خانة الاختيار
                const checkbox = document.querySelector(`input[value="${purchaseId}"]`);
                if (checkbox) {
                    checkbox.checked = false;
                }
                
                // تحديث الواجهة
                if (selectedPurchaseSources.length > 0) {
                    updateQuantityDistribution();
                    updateSelectedSourcesSummary();
                } else {
                    document.getElementById('quantityDistribution').style.display = 'none';
                    document.getElementById('selectedSourcesSummary').style.display = 'none';
                }
            }
        }
        
        // تحديث ملخص المصادر المختارة
        function updateSelectedSourcesSummary() {
            const selectedSourcesList = document.getElementById('selectedSourcesList');
            selectedSourcesList.innerHTML = '';
            
            selectedPurchaseSources.forEach(purchaseId => {
                const purchase = purchases.find(p => p.id === purchaseId);
                if (!purchase) return;
                
                const quantity = quantityDistribution[purchaseId] || 0;
                const sourceItem = document.createElement('div');
                sourceItem.className = 'selected-source-item';
                sourceItem.innerHTML = `
                    <span>مصدر #${purchase.id}: ${quantity.toFixed(2)} كغ</span>
                    <span>سعر: <span class="dollar">$</span> ${purchase.price.toFixed(2)}</span>
                `;
                selectedSourcesList.appendChild(sourceItem);
            });
        }
        
        // إضافة عملية بيع جديدة (متعددة المصادر)
        document.getElementById('saleForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const customerName = document.getElementById('customerName').value;
            const saleQuantity = parseFloat(document.getElementById('saleQuantity').value);
            const salePrice = parseFloat(document.getElementById('salePrice').value);
            
            if (saleQuantity <= 0 || salePrice <= 0) {
                alert('الرجاء إدخال قيم صحيحة أكبر من الصفر | Lütfen sıfırdan büyük geçerli değerler girin');
                return;
            }
            
            // التحقق من وجود مصادر مختارة
            if (selectedPurchaseSources.length === 0) {
                alert('الرجاء اختيار مصدر واحد على الأقل للكمية المباعة | Lütfen satılacak miktar için en az bir kaynak seçin');
                return;
            }
            
            // حساب الكمية الموزعة الإجمالية
            let totalDistributed = 0;
            selectedPurchaseSources.forEach(purchaseId => {
                totalDistributed += quantityDistribution[purchaseId] || 0;
            });
            
            // التحقق من تطابق الكمية الموزعة مع الكمية المطلوبة
            if (Math.abs(totalDistributed - saleQuantity) > 0.01) {
                alert(`الكمية الموزعة (${totalDistributed.toFixed(2)} كغ) لا تطابق الكمية المطلوبة للبيع (${saleQuantity.toFixed(2)} كغ) | Dağıtılan miktar (${totalDistributed.toFixed(2)} kg) satış için gerekli miktarla (${saleQuantity.toFixed(2)} kg) eşleşmiyor`);
                return;
            }
            
            // التحقق من أن الكمية الموزعة لا تتجاوز الكمية المتبقية في كل مصدر
            let isValid = true;
            selectedPurchaseSources.forEach(purchaseId => {
                const purchase = purchases.find(p => p.id === purchaseId);
                const distributedQty = quantityDistribution[purchaseId] || 0;
                
                if (distributedQty > purchase.remaining) {
                    alert(`الكمية الموزعة للمصدر #${purchaseId} (${distributedQty.toFixed(2)} كغ) تتجاوز الكمية المتبقية (${purchase.remaining.toFixed(2)} كغ) | #${purchaseId} kaynağına dağıtılan miktar (${distributedQty.toFixed(2)} kg) kalan miktarı (${purchase.remaining.toFixed(2)} kg) aşıyor`);
                    isValid = false;
                }
            });
            
            if (!isValid) return;
            
            // حساب الربح الإجمالي
            let totalProfit = 0;
            const sourcesDetails = [];
            
            selectedPurchaseSources.forEach(purchaseId => {
                const purchase = purchases.find(p => p.id === purchaseId);
                const distributedQty = quantityDistribution[purchaseId] || 0;
                
                if (distributedQty > 0) {
                    const profitFromSource = (salePrice - purchase.price) * distributedQty;
                    totalProfit += profitFromSource;
                    
                    sourcesDetails.push({
                        purchaseId: purchase.id,
                        quantity: distributedQty,
                        purchasePrice: purchase.price,
                        profit: profitFromSource
                    });
                    
                    // تحديث الكمية المتبقية من الشراء
                    purchase.remaining -= distributedQty;
                }
            });
            
            // إنشاء سجل البيع
            const sale = {
                id: Date.now(),
                customerName: customerName,
                quantity: saleQuantity,
                price: salePrice,
                total: saleQuantity * salePrice,
                profit: totalProfit,
                sources: sourcesDetails,
                date: new Date().toISOString().split('T')[0]
            };
            
            sales.push(sale);
            saveData();
            updatePurchasesTable();
            updateSalesTable();
            updateDashboardStats();
            
            // إعادة تعيين النموذج
            document.getElementById('saleForm').reset();
            selectedPurchaseSources = [];
            quantityDistribution = {};
            document.getElementById('quantityDistribution').style.display = 'none';
            document.getElementById('selectedSourcesSummary').style.display = 'none';
            updatePurchaseOptions();
            
            alert('تم تسجيل عملية البيع بنجاح! | Satış başarıyla kaydedildi!');
        });
        
        // تحديث جدول المشتريات
        function updatePurchasesTable() {
            const tableBody = document.getElementById('purchasesTableBody');
            tableBody.innerHTML = '';
            
            purchases.forEach((purchase, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${purchase.quantity.toFixed(2)} كغ</td>
                    <td><span class="dollar">$</span> ${purchase.price.toFixed(2)}</td>
                    <td><span class="dollar">$</span> ${purchase.total.toFixed(2)}</td>
                    <td>${purchase.date}</td>
                    <td>${purchase.remaining.toFixed(2)} كغ</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // تحديث جدول المبيعات
        function updateSalesTable() {
            const tableBody = document.getElementById('salesTableBody');
            tableBody.innerHTML = '';
            
            sales.forEach((sale, index) => {
                const profitClass = sale.profit >= 0 ? 'badge-sale' : 'badge-purchase';
                const profitSign = sale.profit >= 0 ? '+' : '';
                
                // عرض المصادر
                let sourcesText = '';
                if (sale.sources && sale.sources.length > 0) {
                    sale.sources.forEach((source, i) => {
                        sourcesText += `مصدر #${source.purchaseId}: ${source.quantity.toFixed(2)} كغ<br>`;
                    });
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${sale.customerName}</td>
                    <td>${sale.quantity.toFixed(2)} كغ</td>
                    <td><span class="dollar">$</span> ${sale.price.toFixed(2)}</td>
                    <td><span class="dollar">$</span> ${sale.total.toFixed(2)}</td>
                    <td><span class="badge ${profitClass}"><span class="dollar">$</span> ${profitSign}${sale.profit.toFixed(2)}</span></td>
                    <td>${sale.date}</td>
                    <td style="text-align: right; font-size: 0.9rem;">${sourcesText}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // تحديث إحصائيات لوحة التحكم
        function updateDashboardStats() {
            // إجمالي المشتريات
            const totalPurchases = purchases.reduce((sum, purchase) => sum + purchase.quantity, 0);
            document.getElementById('total-purchases').textContent = totalPurchases.toFixed(2) + ' كغ';
            
            // إجمالي المبيعات
            const totalSales = sales.reduce((sum, sale) => sum + sale.quantity, 0);
            document.getElementById('total-sales').textContent = totalSales.toFixed(2) + ' كغ';
            
            // المخزون الحالي
            const currentInventory = totalPurchases - totalSales;
            document.getElementById('current-inventory').textContent = currentInventory.toFixed(2) + ' كغ';
            
            // إجمالي الربح
            const totalProfit = sales.reduce((sum, sale) => sum + sale.profit, 0);
            document.getElementById('total-profit').innerHTML = totalProfit.toFixed(2) + ' <span class="dollar">$</span>';
        }
        
        // إنشاء تقرير اليوم
        function generateTodayReport() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('reportDate').value = today;
            generateDetailedReport();
        }
        
        // إنشاء تقرير مفصل حسب التاريخ
        function generateDetailedReport() {
            const selectedDate = document.getElementById('reportDate').value;
            
            // تصفية المبيعات حسب التاريخ المحدد
            const dateSales = sales.filter(sale => sale.date === selectedDate);
            
            if (dateSales.length === 0) {
                document.getElementById('reportContent').innerHTML = `
                    <div style="text-align: center; padding: 40px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: var(--border-radius);">
                        <i class="fas fa-exclamation-circle" style="font-size: 3.5rem; color: #e74c3c; margin-bottom: 20px;"></i>
                        <h3 style="color: #e74c3c; margin-bottom: 15px;">لا توجد مبيعات في التاريخ المحدد | Seçilen tarihte satış yok</h3>
                        <p style="font-size: 1.1rem; color: #666;">${selectedDate}</p>
                    </div>
                `;
                return;
            }
            
            // إحصائيات التقرير
            const totalQuantity = dateSales.reduce((sum, sale) => sum + sale.quantity, 0);
            const totalRevenue = dateSales.reduce((sum, sale) => sum + sale.total, 0);
            const totalProfit = dateSales.reduce((sum, sale) => sum + sale.profit, 0);
            
            // إنشاء جدول المبيعات للتقرير
            let salesTableHTML = '';
            dateSales.forEach((sale, index) => {
                // تفاصيل المصادر
                let sourcesDetails = '';
                if (sale.sources && sale.sources.length > 0) {
                    sale.sources.forEach((source, i) => {
                        const purchase = purchases.find(p => p.id === source.purchaseId);
                        const purchasePrice = purchase ? purchase.price : source.purchasePrice;
                        sourcesDetails += `${i > 0 ? '<br>' : ''}مصدر #${source.purchaseId}: ${source.quantity.toFixed(2)} كغ بسعر ${purchasePrice.toFixed(2)}$`;
                    });
                }
                
                const profitClass = sale.profit >= 0 ? 'profit-positive' : 'profit-negative';
                
                salesTableHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${sale.customerName}</td>
                        <td>${sale.quantity.toFixed(2)} كغ</td>
                        <td><span class="dollar">$</span> ${sale.price.toFixed(2)}</td>
                        <td><span class="dollar">$</span> ${sale.total.toFixed(2)}</td>
                        <td class="${profitClass}"><span class="dollar">$</span> ${sale.profit.toFixed(2)}</td>
                        <td>${sourcesDetails || 'غير معروف'}</td>
                    </tr>
                `;
            });
            
            // إجماليات المشتريات والمبيعات الكلية
            const totalPurchasesAll = purchases.reduce((sum, purchase) => sum + purchase.quantity, 0);
            const totalSalesAll = sales.reduce((sum, sale) => sum + sale.quantity, 0);
            const totalProfitAll = sales.reduce((sum, sale) => sum + sale.profit, 0);
            
            let reportHTML = `
                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 25px; border-radius: var(--border-radius); margin-bottom: 30px;">
                    <h3 style="color: var(--primary-color); text-align: center; margin-bottom: 20px;">ملخص التقرير | Rapor Özeti - ${selectedDate}</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.05);">
                            <h4 style="color: var(--primary-color); margin-bottom: 10px;">عدد المعاملات | İşlem Sayısı</h4>
                            <p style="font-size: 1.8rem; font-weight: bold; color: var(--secondary-color);">${dateSales.length}</p>
                        </div>
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.05);">
                            <h4 style="color: var(--primary-color); margin-bottom: 10px;">إجمالي الكمية المباعة | Toplam Satılan Miktar</h4>
                            <p style="font-size: 1.8rem; font-weight: bold; color: var(--accent-color);">${totalQuantity.toFixed(2)} كغ</p>
                        </div>
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.05);">
                            <h4 style="color: var(--primary-color); margin-bottom: 10px;">إجمالي الربح | Toplam Kâr</h4>
                            <p style="font-size: 1.8rem; font-weight: bold; color: var(--success-color);"><span class="dollar">$</span> ${totalProfit.toFixed(2)}</p>
                        </div>
                    </div>
                </div>
                
                <h3 style="color: var(--primary-color); margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid var(--light-color);">تفاصيل المبيعات | Satış Detayları</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>اسم العميل | Müşteri Adı</th>
                                <th>الكمية | Miktar</th>
                                <th>سعر البيع | Satış Fiyatı</th>
                                <th>الإجمالي | Toplam</th>
                                <th>الربح | Kâr</th>
                                <th>المصادر | Kaynaklar</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${salesTableHTML}
                        </tbody>
                        <tfoot style="font-weight: bold; background-color: #f8f9fa;">
                            <tr>
                                <td colspan="2">إجمالي اليوم | Günlük Toplam</td>
                                <td>${totalQuantity.toFixed(2)} كغ</td>
                                <td colspan="2"></td>
                                <td><span class="dollar">$</span> ${totalProfit.toFixed(2)}</td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                
                <div style="margin-top: 30px; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); padding: 25px; border-radius: var(--border-radius);">
                    <h3 style="color: var(--primary-color); margin-bottom: 20px; text-align: center;">الإجماليات الكلية | Genel Toplamlar</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.05);">
                            <h4 style="color: var(--primary-color); margin-bottom: 10px;">إجمالي المشتريات | Toplam Alımlar</h4>
                            <p style="font-size: 1.5rem; font-weight: bold;">${totalPurchasesAll.toFixed(2)} كغ</p>
                        </div>
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.05);">
                            <h4 style="color: var(--primary-color); margin-bottom: 10px;">إجمالي المبيعات | Toplam Satışlar</h4>
                            <p style="font-size: 1.5rem; font-weight: bold;">${totalSalesAll.toFixed(2)} كغ</p>
                        </div>
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.05);">
                            <h4 style="color: var(--primary-color); margin-bottom: 10px;">المخزون الحالي | Mevcut Stok</h4>
                            <p style="font-size: 1.5rem; font-weight: bold;">${(totalPurchasesAll - totalSalesAll).toFixed(2)} كغ</p>
                        </div>
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.05);">
                            <h4 style="color: var(--primary-color); margin-bottom: 10px;">إجمالي الربح الكلي | Toplam Kâr</h4>
                            <p style="font-size: 1.5rem; font-weight: bold; color: var(--success-color);"><span class="dollar">$</span> ${totalProfitAll.toFixed(2)}</p>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('reportContent').innerHTML = reportHTML;
            
            // تحديث التقرير القابل للطباعة أيضًا
            updatePrintableReport(selectedDate, dateSales, totalQuantity, totalRevenue, totalProfit, totalPurchasesAll, totalSalesAll, totalProfitAll);
        }
        
        // تحديث التقرير القابل للطباعة
        function updatePrintableReport(selectedDate, dateSales, totalQuantity, totalRevenue, totalProfit, totalPurchasesAll, totalSalesAll, totalProfitAll) {
            // إنشاء جدول المبيعات للتقرير القابل للطباعة
            let salesTableHTML = '';
            dateSales.forEach((sale, index) => {
                // تفاصيل المصادر
                let sourcesDetails = '';
                if (sale.sources && sale.sources.length > 0) {
                    sale.sources.forEach((source, i) => {
                        const purchase = purchases.find(p => p.id === source.purchaseId);
                        const purchasePrice = purchase ? purchase.price : source.purchasePrice;
                        sourcesDetails += `${i > 0 ? '<br>' : ''}مصدر #${source.purchaseId}: ${source.quantity.toFixed(2)} كغ - ${purchasePrice.toFixed(2)}$`;
                    });
                }
                
                const profitClass = sale.profit >= 0 ? 'profit-positive' : 'profit-negative';
                
                salesTableHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${sale.customerName}</td>
                        <td>${sale.quantity.toFixed(2)} كغ</td>
                        <td><span class="dollar-print">$</span> ${sale.price.toFixed(2)}</td>
                        <td><span class="dollar-print">$</span> ${sale.total.toFixed(2)}</td>
                        <td class="${profitClass}"><span class="dollar-print">$</span> ${sale.profit.toFixed(2)}</td>
                        <td>${sourcesDetails || 'غير معروف'}</td>
                    </tr>
                `;
            });
            
            const printDate = new Date().toLocaleDateString('ar-EG');
            
            const printableReportHTML = `
                <div class="print-header">
                    <h1>ALANHAR SILVER</h1>
                    <h2>تقرير المبيعات اليومي | Günlük Satış Raporu</h2>
                    <div style="display: flex; justify-content: center; gap: 30px; margin-top: 15px;">
                        <div>
                            <p><strong>تاريخ التقرير | Rapor Tarihi:</strong> ${selectedDate}</p>
                        </div>
                        <div>
                            <p><strong>تاريخ الإنشاء | Oluşturma Tarihi:</strong> ${printDate}</p>
                        </div>
                    </div>
                </div>
                
                <div class="print-summary">
                    <h3 style="text-align: center; margin-bottom: 15px;">ملخص التقرير | Rapor Özeti</h3>
                    <div style="display: flex; justify-content: space-around; flex-wrap: wrap;">
                        <div style="text-align: center; padding: 10px;">
                            <p><strong>عدد المعاملات | İşlem Sayısı:</strong> ${dateSales.length}</p>
                            <p><strong>إجمالي الكمية المباعة | Toplam Satılan Miktar:</strong> ${totalQuantity.toFixed(2)} كغ</p>
                        </div>
                        <div style="text-align: center; padding: 10px;">
                            <p><strong>إجمالي الإيرادات | Toplam Gelir:</strong> <span class="dollar-print">$</span> ${totalRevenue.toFixed(2)}</p>
                            <p><strong>إجمالي الربح | Toplam Kâr:</strong> <span class="dollar-print">$</span> ${totalProfit.toFixed(2)}</p>
                        </div>
                    </div>
                </div>
                
                <h3 style="text-align: center; margin: 20px 0;">تفاصيل المبيعات | Satış Detayları</h3>
                <table class="print-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>اسم العميل<br>Müşteri Adı</th>
                            <th>الكمية<br>Miktar</th>
                            <th>سعر البيع<br>Satış Fiyatı</th>
                            <th>الإجمالي<br>Toplam</th>
                            <th>الربح<br>Kâr</th>
                            <th>المصادر<br>Kaynaklar</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${salesTableHTML}
                    </tbody>
                    <tfoot>
                        <tr style="background-color: #e8f5e9 !important;">
                            <td colspan="2"><strong>إجمالي اليوم | Günlük Toplam</strong></td>
                            <td><strong>${totalQuantity.toFixed(2)} كغ</strong></td>
                            <td colspan="2"></td>
                            <td><strong><span class="dollar-print">$</span> ${totalProfit.toFixed(2)}</strong></td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
                
                <div class="print-totals">
                    <h3 style="text-align: center; margin-bottom: 15px;">الإجماليات الكلية | Genel Toplamlar</h3>
                    <div style="display: flex; justify-content: space-around; flex-wrap: wrap;">
                        <div style="text-align: center; padding: 10px;">
                            <p><strong>إجمالي المشتريات | Toplam Alımlar:</strong> ${totalPurchasesAll.toFixed(2)} كغ</p>
                            <p><strong>إجمالي المبيعات | Toplam Satışlar:</strong> ${totalSalesAll.toFixed(2)} كغ</p>
                        </div>
                        <div style="text-align: center; padding: 10px;">
                            <p><strong>المخزون الحالي | Mevcut Stok:</strong> ${(totalPurchasesAll - totalSalesAll).toFixed(2)} كغ</p>
                            <p><strong>إجمالي الربح الكلي | Toplam Kâr:</strong> <span class="dollar-print">$</span> ${totalProfitAll.toFixed(2)}</p>
                        </div>
                    </div>
                </div>
                
                <div class="print-signature">
                    <div style="display: flex; justify-content: space-between; margin-top: 30px;">
                        <div style="text-align: center; width: 45%;">
                            <p style="border-top: 1px solid #000; padding-top: 5px; margin-top: 40px;">التوقيع | İmza</p>
                            <p>المسؤول | Yetkili</p>
                        </div>
                        <div style="text-align: center; width: 45%;">
                            <p style="border-top: 1px solid #000; padding-top: 5px; margin-top: 40px;">التاريخ | Tarih</p>
                            <p>${selectedDate}</p>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 30px; font-size: 10pt;">
                        <p>ALANHAR SILVER - نظام إدارة مخزون الفضة | Gümüş Stok Yönetim Sistemi</p>
                        <p>تم إنشاء هذا التقرير تلقائيًا من النظام | Bu rapor sistem tarafından otomatik olarak oluşturulmuştur</p>
                    </div>
                </div>
            `;
            
            document.getElementById('printable-report').innerHTML = printableReportHTML;
        }
        
        // طباعة التقرير مباشرة
        function printReportDirectly() {
            const selectedDate = document.getElementById('reportDate').value;
            const dateSales = sales.filter(sale => sale.date === selectedDate);
            
            if (dateSales.length === 0) {
                alert('لا توجد مبيعات في التاريخ المحدد للطباعة | Seçilen tarihte yazdırılacak satış yok');
                return;
            }
            
            // تحديث التقرير القابل للطباعة أولاً
            const totalQuantity = dateSales.reduce((sum, sale) => sum + sale.quantity, 0);
            const totalRevenue = dateSales.reduce((sum, sale) => sum + sale.total, 0);
            const totalProfit = dateSales.reduce((sum, sale) => sum + sale.profit, 0);
            const totalPurchasesAll = purchases.reduce((sum, purchase) => sum + purchase.quantity, 0);
            const totalSalesAll = sales.reduce((sum, sale) => sum + sale.quantity, 0);
            const totalProfitAll = sales.reduce((sum, sale) => sum + sale.profit, 0);
            
            updatePrintableReport(selectedDate, dateSales, totalQuantity, totalRevenue, totalProfit, totalPurchasesAll, totalSalesAll, totalProfitAll);
            
            // إظهار التقرير القابل للطباعة
            document.getElementById('printable-report').style.display = 'block';
            
            // الانتظار قليلاً ثم الطباعة
            setTimeout(() => {
                window.print();
                // إخفاء التقرير بعد الطباعة
                setTimeout(() => {
                    document.getElementById('printable-report').style.display = 'none';
                }, 100);
            }, 100);
        }
        
        // حفظ البيانات في localStorage
        function saveData() {
            localStorage.setItem('alanharPurchases', JSON.stringify(purchases));
            localStorage.setItem('alanharSales', JSON.stringify(sales));
        }
        
        // إعادة تعيين جميع البيانات
        function resetAllData() {
            if (confirm('هل أنت متأكد من حذف جميع البيانات؟ هذا الإجراء لا يمكن التراجع عنه. | Tüm verileri silmek istediğinize emin misiniz? Bu işlem geri alınamaz.')) {
                purchases = [];
                sales = [];
                selectedPurchaseSources = [];
                quantityDistribution = {};
                
                localStorage.removeItem('alanharPurchases');
                localStorage.removeItem('alanharSales');
                
                updatePurchasesTable();
                updateSalesTable();
                updateDashboardStats();
                updatePurchaseOptions();
                document.getElementById('reportContent').innerHTML = '';
                
                alert('تم حذف جميع البيانات بنجاح | Tüm veriler başarıyla silindi');
            }
        }
        
        // تصدير البيانات
        function exportData() {
            const data = {
                purchases: purchases,
                sales: sales,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `alanhar-silver-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            
            alert('تم تصدير البيانات بنجاح | Veriler başarıyla dışa aktarıldı');
        }
        
        // استيراد البيانات
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.purchases && data.sales) {
                        purchases = data.purchases;
                        sales = data.sales;
                        selectedPurchaseSources = [];
                        quantityDistribution = {};
                        
                        saveData();
                        updatePurchasesTable();
                        updateSalesTable();
                        updateDashboardStats();
                        updatePurchaseOptions();
                        generateTodayReport();
                        
                        alert('تم استيراد البيانات بنجاح | Veriler başarıyla içe aktarıldı');
                    } else {
                        alert('ملف غير صالح | Geçersiz dosya');
                    }
                } catch (error) {
                    alert('خطأ في قراءة الملف | Dosya okuma hatası');
                }
            };
            reader.readAsText(file);
        }
        
        // تحديث توزيع الكمية عند تغيير كمية البيع
        document.getElementById('saleQuantity').addEventListener('input', function() {
            if (selectedPurchaseSources.length > 0) {
                updateQuantityDistribution();
            }
        });
        
        // إضافة أزرار التحكم في الواجهة
        document.addEventListener('DOMContentLoaded', function() {
            const header = document.querySelector('header .container');
            
            // زر حذف جميع البيانات
            const resetButton = document.createElement('button');
            resetButton.innerHTML = '<i class="fas fa-trash-alt"></i> حذف جميع البيانات | Tüm Verileri Sil';
            resetButton.className = 'btn btn-danger no-print';
            resetButton.style.position = 'absolute';
            resetButton.style.top = '25px';
            resetButton.style.left = '25px';
            resetButton.onclick = resetAllData;
            
            // زر تصدير البيانات
            const exportButton = document.createElement('button');
            exportButton.innerHTML = '<i class="fas fa-download"></i> تصدير البيانات | Verileri Dışa Aktar';
            exportButton.className = 'btn btn-warning no-print';
            exportButton.style.position = 'absolute';
            exportButton.style.top = '25px';
            exportButton.style.right = '25px';
            exportButton.onclick = exportData;
            
            // زر استيراد البيانات
            const importInput = document.createElement('input');
            importInput.type = 'file';
            importInput.accept = '.json';
            importInput.style.display = 'none';
            importInput.id = 'importInput';
            importInput.onchange = importData;
            document.body.appendChild(importInput);
            
            const importButton = document.createElement('button');
            importButton.innerHTML = '<i class="fas fa-upload"></i> استيراد البيانات | Verileri İçe Aktar';
            importButton.className = 'btn btn-success no-print';
            importButton.style.position = 'absolute';
            importButton.style.top = '80px';
            importButton.style.right = '25px';
            importButton.onclick = () => document.getElementById('importInput').click();
            
            header.style.position = 'relative';
            header.appendChild(resetButton);
            header.appendChild(exportButton);
            header.appendChild(importButton);
        });
    </script>
</body>
</html>
